<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pedido de Ora√ß√£o</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { font-weight: bold; }
    textarea, input { width: 100%; margin-bottom: 10px; }
    .opcoes { margin-bottom: 10px; display: flex; gap: 20px; }
    .opcao { display: flex; align-items: center; gap: 5px; }
    button { padding: 8px 15px; margin-top: 10px; }
    #consulta { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 15px; }
    #resultados { margin-top: 10px; background: #f9f9f9; padding: 10px; border-radius: 5px; }
    #loginBox { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 15px; }
  </style>
</head>
<body>
  <h2>Pedido de Ora√ß√£o üôè</h2>

  <!-- Formul√°rio de pedidos -->
  <form id="formulario">
    <label for="nome">Nome:</label><br>
    <input type="text" id="nome" required><br>

    <label>Sexo:</label><br>
    <div class="opcoes">
      <label class="opcao">
        <input type="radio" id="masc" name="sexo" value="MASCULINO" required>
        <span>MASCULINO</span>
      </label>
      <label class="opcao">
        <input type="radio" id="fem" name="sexo" value="FEMININO" required>
        <span>FEMININO</span>
      </label>
    </div>

    <label for="pedido">Pedido de Ora√ß√£o:</label><br>
    <textarea id="pedido" rows="4" required></textarea><br>

    <button type="submit">Gravar Pedido de Ora√ß√£o</button>
  </form>

  <!-- Consulta de pedidos -->
  <div id="consulta">
    <h3>Consultar Pedidos de Ora√ß√£o üîç</h3>
    <label for="nomeConsulta">Digite o nome:</label><br>
    <input type="text" id="nomeConsulta"><br>

    <label for="dataConsulta">Selecione a data (opcional):</label><br>
    <input type="date" id="dataConsulta"><br>

    <button onclick="consultarPedidos()">PESQUISAR</button>
    <div id="resultados"></div>
  </div>

  <!-- Login do administrador -->
  <div id="loginBox">
    <h3>Login do Administrador üîë</h3>
    <label for="usuarioLogin">Usu√°rio:</label><br>
    <input type="text" id="usuarioLogin"><br>
    <label for="senhaLogin">Senha:</label><br>
    <input type="password" id="senhaLogin"><br>
    <button onclick="fazerLogin()">Login Admin</button>
  </div>

  <script>
    // ==============================
    // Parte 1 - Gravar pedidos
    // ==============================
    document.getElementById("formulario").addEventListener("submit", function(e){
      e.preventDefault();

      let nome = document.getElementById("nome").value.trim();
      let sexo = document.querySelector("input[name='sexo']:checked")?.value;
      let pedido = document.getElementById("pedido").value.trim();
      let dataRegistro = new Date().toLocaleDateString("pt-BR", {
        day: "2-digit", month: "2-digit", year: "numeric"
      });

      if(nome && sexo && pedido){
        let pedidos = JSON.parse(localStorage.getItem("pedidosOracao")) || [];
        pedidos.push({nome, sexo, pedido, data: dataRegistro});
        localStorage.setItem("pedidosOracao", JSON.stringify(pedidos));

        alert("üôè Pedido de ora√ß√£o gravado com sucesso!");
        document.getElementById("formulario").reset();
      }
    });

    // ==============================
    // Parte 2 - Consultar pedidos por nome e data
    // ==============================
    function consultarPedidos(){
      let nomeConsulta = document.getElementById("nomeConsulta").value.trim().toLowerCase();
      let dataInput = document.getElementById("dataConsulta").value;
      let resultadosDiv = document.getElementById("resultados");
      resultadosDiv.innerHTML = "";

      if(!nomeConsulta){
        alert("Digite um nome para pesquisar.");
        return;
      }

      let pedidos = JSON.parse(localStorage.getItem("pedidosOracao")) || [];
      let encontrados = pedidos.filter(p => {
        let nomeMatch = p.nome.toLowerCase() === nomeConsulta;
        if(dataInput){
          // Converte "2025-09-15" em "15/09/2025"
          let partes = dataInput.split("-");
          let dataBusca = partes[2] + "/" + partes[1] + "/" + partes[0];
          return nomeMatch && p.data === dataBusca;
        }
        return nomeMatch;
      });

      if(encontrados.length > 0){
        let html = "<h4>Resultados:</h4><ul>";
        encontrados.forEach((p, i) => {
          html += "<li>üìÖ " + p.data + " ‚Äî " + p.nome + ": " + p.pedido + "</li>";
        });
        html += "</ul>";
        resultadosDiv.innerHTML = html;
      } else {
        resultadosDiv.innerHTML = "<p>Nenhum pedido encontrado para este nome nesta data.</p>";
      }
    }

    // ==============================
    // Parte 3 - Login do administrador
    // ==============================
    if(!localStorage.getItem("adminUser")){
      localStorage.setItem("adminUser", "admin");
      localStorage.setItem("adminPass", "admin");
      localStorage.setItem("senhaAlterada", "false");
    }

    function fazerLogin(){
      let usuario = document.getElementById("usuarioLogin").value.trim();
      let senha = document.getElementById("senhaLogin").value.trim();

      let userSalvo = localStorage.getItem("adminUser");
      let passSalvo = localStorage.getItem("adminPass");
      let senhaAlterada = localStorage.getItem("senhaAlterada") === "true";

      if(usuario === userSalvo && senha === passSalvo){
        if(!senhaAlterada){
          let novaSenha = prompt("Voc√™ est√° usando a senha padr√£o. Defina uma nova senha:");
          if(novaSenha && novaSenha.trim() !== ""){
            localStorage.setItem("adminPass", novaSenha.trim());
            localStorage.setItem("senhaAlterada", "true");
            alert("‚úÖ Senha alterada com sucesso! Use sua nova senha nos pr√≥ximos logins.");
          } else {
            alert("‚ö†Ô∏è A senha n√£o foi alterada. Continue usando a senha padr√£o.");
          }
        }
        window.location.href = "admin.html";
      } else {
        alert("‚ùå Usu√°rio ou senha incorretos!");
      }
    }
  </script>
</body>
</html>
