<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Login - Pedidos de Ora√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Arial,sans-serif;background:#f4f6f8;margin:0}
    header{background:#2c3e50;color:#fff;padding:20px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.15)}
    .container{max-width:400px;margin:40px auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.1)}
    h2{margin-top:0}
    label{display:block;margin:12px 0 6px;font-weight:bold}
    input{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px}
    button{margin-top:16px;width:100%;padding:14px;background:#27ae60;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer}
    button:hover{background:#219150}
    .btn-home{margin-top:12px;background:#fff;color:#2c3e50;border:1px solid #ccc}
    .btn-home:hover{background:#f7f9fb}
  </style>
</head>
<body>
  <header>
    <h1>üîë Login</h1>
  </header>

  <div class="container">
    <h2>Entre na sua conta</h2>
    <form id="loginForm">
      <label for="email">E-mail:</label>
      <input type="email" id="email" required />
      <label for="senha">Senha:</label>
      <input type="password" id="senha" required />
      <button type="submit">Entrar</button>
      <button type="button" class="btn-home" onclick="location.href='index.html'">üè† P√°gina Inicial</button>
    </form>
  </div>

  <script>
    // Busca usu√°rio por email nos dois formatos de armazenamento:
    // - 'cadastrosUsuarios' (array com v√°rios)
    // - 'cadastroUsuario' (objeto √∫nico, legado)
    function obterUsuarioPorEmail(email){
      const lista = JSON.parse(localStorage.getItem("cadastrosUsuarios")) || [];
      if(Array.isArray(lista) && lista.length){
        const encontrado = lista.find(u => (u.email || "").toLowerCase() === email.toLowerCase());
        if(encontrado) return { tipo: "lista", usuario: encontrado, lista };
      }
      const unico = JSON.parse(localStorage.getItem("cadastroUsuario"));
      if(unico && (unico.email || "").toLowerCase() === email.toLowerCase()){
        return { tipo: "unico", usuario: unico };
      }
      return null;
    }

    function salvarUsuarioAtualizado(contexto, usuarioAtualizado){
      if(contexto.tipo === "lista"){
        const lista = contexto.lista.map(u =>
          (u.email||"").toLowerCase() === (usuarioAtualizado.email||"").toLowerCase() ? usuarioAtualizado : u
        );
        localStorage.setItem("cadastrosUsuarios", JSON.stringify(lista));
      } else {
        localStorage.setItem("cadastroUsuario", JSON.stringify(usuarioAtualizado));
      }
    }

    document.getElementById("loginForm").addEventListener("submit", function(e){
      e.preventDefault();

      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value;

      const contexto = obterUsuarioPorEmail(email);
      if(!contexto){
        alert("‚ùå E-mail n√£o encontrado.");
        return;
      }

      const user = contexto.usuario;
      if(user.senha !== senha){
        alert("‚ùå Senha incorreta.");
        return;
      }

      // Enforce troca de senha caso admin tenha marcado resetObrigatorio e senha padr√£o
      if(user.resetObrigatorio === true && senha === "12345678"){
        const nova = prompt("Voc√™ deve alterar sua senha agora (m√≠n. 6 caracteres):");
        if(!nova || nova.length < 6){
          alert("‚ö†Ô∏è Senha n√£o alterada. Tente novamente.");
          return;
        }
        user.senha = nova;
        user.resetObrigatorio = false;
        salvarUsuarioAtualizado(contexto, user);
        alert("‚úÖ Senha alterada com sucesso!");
      }

      // Regra solicitada: se email for leoguerramaia@gmail.com => ir para admin.html
      if(email.toLowerCase() === "leoguerramaia@gmail.com"){
        window.location.href = "admin.html";
      } else {
        window.location.href = "usuario.html";
      }
    });
  </script>
</body>
</html>
