<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Admin - Pedidos de Ora√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f4f6f8;
      --card:#ffffff;
      --text:#2c3e50;
      --muted:#6b7b8c;
      --primary:#27ae60;        /* a√ß√µes principais */
      --primary-hov:#219150;
      --accent:#2c3e50;         /* cabe√ßalho */
      --accent-hov:#233241;
      --ring: rgba(39,174,96,.35);
      --blue:#2980b9;           /* copiar */
      --blue-hov:#216698;
      --violet:#8e44ad;         /* buscar */
      --violet-hov:#732d91;
      --danger:#e74c3c;         /* zerar */
      --danger-hov:#c13b2d;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--text);
    }
    header{
      background:var(--accent); color:#fff; padding:20px 16px; text-align:center;
      position:sticky; top:0; z-index:10; box-shadow:0 2px 10px rgba(0,0,0,.15);
    }
    header h1{margin:0; font-size:22px; letter-spacing:.3px}
    .container{max-width:900px; margin:32px auto; padding:0 16px;}
    .card{
      background:var(--card); border-radius:14px; padding:24px;
      box-shadow:0 12px 30px rgba(0,0,0,.08);
      border:1px solid rgba(0,0,0,.04);
      margin-bottom:24px;
    }
    h2{margin:0 0 6px 0; font-size:22px}
    .subtitle{color:var(--muted); margin:0 0 20px 0; font-size:14px}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .btn{
      appearance:none; border:none; border-radius:10px; padding:12px 16px; cursor:pointer;
      font-weight:700; letter-spacing:.3px; transition:transform .02s, box-shadow .2s, background .2s;
      box-shadow:0 6px 16px rgba(0,0,0,.06); color:#fff;
    }
    .btn:active{transform:translateY(1px)}
    .btn-copy{background:var(--blue)} .btn-copy:hover{background:var(--blue-hov)}
    .btn-save{background:var(--primary)} .btn-save:hover{background:var(--primary-hov)}
    .btn-clear{background:var(--danger)} .btn-clear:hover{background:var(--danger-hov)}
    .btn-home{
      background:#fff; color:var(--accent); border:1px solid #e1e5ea;
      box-shadow:0 6px 16px rgba(0,0,0,.04);
    }
    .btn-home:hover{background:#f7f9fb}
    ul{padding-left:18px}
    li{margin:6px 0}
    .meta{color:var(--muted); font-size:13px; margin-bottom:2px}
    input[type="date"]{
      padding:10px 12px; border-radius:10px; border:1px solid #e1e5ea; background:#fff;
      color:var(--text); outline:none; transition:border .2s, box-shadow .2s;
    }
    input[type="date"]:focus{border-color:var(--primary); box-shadow:0 0 0 4px var(--ring)}
    .result{
      margin-top:12px; background:#f9f9f9; border:1px solid #eef2f6;
      border-radius:10px; padding:12px;
    }
    .section-title{display:flex; align-items:baseline; justify-content:space-between; gap:8px}
  </style>
</head>
<body>
  <header>
    <h1>‚öôÔ∏è Administra√ß√£o ‚Äî Pedidos de Ora√ß√£o</h1>
  </header>

  <main class="container">
    <!-- Painel principal -->
    <section class="card">
      <div class="section-title">
        <div>
          <h2>Lista de Pedidos Atuais</h2>
          <p id="data-geral" class="subtitle"></p>
        </div>
        <button class="btn btn-home" onclick="location.href='index.html'">üè† P√°gina Inicial</button>
      </div>

      <ul id="lista"></ul>

      <div class="row" style="margin-top:12px">
        <button class="btn btn-copy" onclick="copiarPedidos()">üìã Copiar Todos os Pedidos</button>
        <button class="btn btn-save" onclick="salvarPorData()">üíæ Salvar por Data</button>
        <button class="btn btn-clear" onclick="zerarPedidos()">üóëÔ∏è Zerar Pedidos</button>
      </div>
    </section>

    <!-- Hist√≥rico por data -->
    <section class="card">
      <h2>Consultar Hist√≥rico por Data üîç</h2>
      <p class="subtitle">Selecione uma data para ver os pedidos arquivados naquele dia.</p>

      <div class="row">
        <input type="date" id="dataBusca" />
        <button class="btn" style="background:var(--violet)" onClick="buscarPorData()">PESQUISAR</button>
      </div>

      <div id="resultadoBusca" class="result" aria-live="polite"></div>
    </section>
  </main>

  <script>
    // ===== Estado inicial
    let pedidos = JSON.parse(localStorage.getItem("pedidosOracao")) || [];
    let historico = JSON.parse(localStorage.getItem("historicoOracao")) || {};
    const dataHoje = new Date();
    const dataFormatada = dataHoje.toLocaleDateString("pt-BR", { day: "2-digit", month: "2-digit", year: "numeric" });
    document.getElementById("data-geral").textContent = "üìÖ Data de refer√™ncia: " + dataFormatada;

    // ===== Render lista atual
    function atualizarLista(){
      const lista = document.getElementById("lista");
      lista.innerHTML = "";
      if(pedidos.length === 0){
        const li = document.createElement("li");
        li.textContent = "Nenhum pedido adicionado ainda.";
        lista.appendChild(li);
        return;
      }
      pedidos.forEach(p => {
        const li = document.createElement("li");
        // se existir p.data, mostramos tamb√©m
        const dataTxt = p.data ? ` (${p.data})` : "";
        li.textContent = `[${p.sexo}] ${p.nome}: ${p.pedido}${dataTxt}`;
        lista.appendChild(li);
      });
    }
    atualizarLista();

    // ===== Copiar pedidos agrupados
    function copiarPedidos(){
      if(pedidos.length === 0){
        alert("Nenhum pedido adicionado ainda.");
        return;
      }
      const masc = pedidos.filter(p => p.sexo === "MASCULINO");
      const fem  = pedidos.filter(p => p.sexo === "FEMININO");

      let texto = "üìñ Lista de Pedidos de Ora√ß√£o (" + dataFormatada + ")\n\n";

      if(masc.length > 0){
        texto += "üë® PEDIDOS DOS HOMENS:\n";
        masc.forEach((p, i) => { texto += (i+1) + ". " + p.nome + " - " + p.pedido + "\n"; });
        texto += "\n";
      }
      if(fem.length > 0){
        texto += "üë© PEDIDOS DAS MULHERES:\n";
        fem.forEach((p, i) => { texto += (i+1) + ". " + p.nome + " - " + p.pedido + "\n"; });
      }

      navigator.clipboard.writeText(texto).then(() => {
        alert("Pedidos copiados! Cole no WhatsApp ‚úÖ");
      });
    }

    // ===== Salvar por Data (arquiva tudo do dia e zera lista atual)
    function salvarPorData(){
      if(pedidos.length === 0){
        alert("Nenhum pedido para salvar.");
        return;
      }
      // salva todos os pedidos atuais na chave da data de refer√™ncia
      historico[dataFormatada] = pedidos;
      localStorage.setItem("historicoOracao", JSON.stringify(historico));

      // zera a lista atual
      pedidos = [];
      localStorage.removeItem("pedidosOracao");
      atualizarLista();

      alert("‚úÖ Pedidos salvos no hist√≥rico da data " + dataFormatada + " e lista atual zerada.");
    }

    // ===== Buscar por Data (via calend√°rio)
    function buscarPorData(){
      const dataInput = document.getElementById("dataBusca").value;
      const out = document.getElementById("resultadoBusca");
      out.innerHTML = "";

      if(!dataInput){
        alert("Selecione uma data no calend√°rio.");
        return;
      }
      // "2025-09-15" -> "15/09/2025"
      const [y,m,d] = dataInput.split("-");
      const chave = `${d}/${m}/${y}`;

      const hist = JSON.parse(localStorage.getItem("historicoOracao")) || {};
      const pedidosData = hist[chave];

      if(pedidosData && pedidosData.length > 0){
        let html = `<strong>Pedidos em ${chave}:</strong><ul>`;
        pedidosData.forEach(p => {
          html += `<li>${p.nome}: ${p.pedido}</li>`;
        });
        html += "</ul>";
        out.innerHTML = html;
      } else {
        out.innerHTML = `<span class="meta">‚ùå Nenhum pedido encontrado para ${chave}.</span>`;
      }
    }

    // ===== Zerar lista atual
    function zerarPedidos(){
      if(confirm("Tem certeza que deseja apagar todos os pedidos atuais?")){
        pedidos = [];
        localStorage.removeItem("pedidosOracao");
        atualizarLista();
        alert("Todos os pedidos foram zerados.");
      }
    }
  </script>
</body>
</html>
