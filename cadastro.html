<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro - Pedidos de Ora√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#fff7f2;
      --card:#ffffff;
      --text:#2c3e50;
      --muted:#6b7b8c;
      --primary:#b22222;
      --primary-hov:#800000;
      --accent:#ff4500;
      --accent-hov:#e03c00;
      --ring:rgba(178,34,34,.35);
    }
    *, *::before, *::after { box-sizing: border-box; }

    body{
      margin:0;
      font-family:system-ui, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      background:var(--primary);
      color:#ffd700;
      padding:20px;
      text-align:center;
    }
    header h1{margin:0;font-size:24px;}

    .container{max-width:720px;margin:32px auto;padding:0 16px;}
    .card{
      background:var(--card);
      border-radius:14px;
      padding:24px;
      box-shadow:0 12px 30px rgba(0,0,0,.08);
    }

    form{display:flex;flex-direction:column;gap:12px}
    label{font-weight:600;margin-top:8px}
    label .required{color:var(--primary);margin-left:4px}

    input, select, button{
      width:100%;padding:12px 14px;border-radius:10px;font-size:15px;
      border:1px solid #e1e5ea;outline:none;background:#fff;
    }
    input:focus, select:focus{border-color:var(--primary);box-shadow:0 0 0 4px var(--ring)}

    .erro{color:var(--primary);font-size:13px;display:none}
    .msg{color:var(--muted);font-size:13px;margin-top:-6px}

    .preview{font-size:14px;margin-top:6px}
    .preview a{color:var(--primary);text-decoration:none;display:flex;align-items:center;gap:6px}
    .preview img{width:20px;height:20px}

    .senha-container{position:relative;display:flex;align-items:center;}
    .senha-container input{width:100%;padding-right:40px;}
    .toggle-senha{position:absolute;right:10px;cursor:pointer;font-size:18px;color:var(--muted);}

    .obrigatorio{font-size:13px;color:var(--muted);margin-top:4px;}

    button{border:none;font-weight:700;cursor:pointer;transition:.3s}
    .btn-main{background:var(--primary);color:#fff}
    .btn-main:hover{background:var(--primary-hov)}

    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row>div{flex:1;min-width:150px}

    /* Novo estilo para foto */
    .foto-container{text-align:center;margin-bottom:16px;}
    .foto-preview{
      width:120px;height:120px;border-radius:50%;object-fit:cover;
      border:2px solid var(--primary);margin-bottom:8px;display:none;
    }
    .foto-btn{display:block;margin:0 auto;color:var(--primary);cursor:pointer;font-weight:600;}
  </style>
</head>
<body>
  <header><h1>üìù Cadastro</h1></header>
  <main class="container">
    <section class="card">
      <form id="formCadastro">

        <!-- Foto do usu√°rio -->
        <div class="foto-container">
          <img id="fotoPreview" class="foto-preview" alt="Foto do usu√°rio">
          <label for="foto" class="foto-btn">üì∑ Adicionar Foto</label>
          <input type="file" id="foto" accept="image/*" capture="environment" style="display:none">
        </div>

        <label for="nome">Nome:<span class="required">*</span></label>
        <input type="text" id="nome" required>

        <label for="apelido">Como Gosta de Ser Chamado:</label>
        <input type="text" id="apelido" placeholder="Ex: Leo, Mariazinha, Pastor Jo√£o">

        <!-- Sexo -->
        <label for="sexo">Sexo:<span class="required">*</span></label>
        <select id="sexo" required>
          <option value="">Selecione...</option>
          <option value="MASCULINO">Masculino</option>
          <option value="FEMININO">Feminino</option>
        </select>

        <!-- Telefone -->
        <label for="telefone">Telefone (DDD + n√∫mero):<span class="required">*</span></label>
        <input type="tel" id="telefone" placeholder="Ex: 11987654321" pattern="\d{10,11}" required>
        <div id="whatsLink" class="preview"></div>

        <!-- E-mail -->
        <label for="email">E-mail:<span class="required">*</span></label>
        <input type="email" id="email" required>
        <div id="emailErro" class="erro">‚ùå J√° existe um cadastro com este e-mail.</div>

        <!-- CEP -->
        <label for="cep">CEP:</label>
        <input type="text" id="cep" maxlength="8" placeholder="Somente n√∫meros" onblur="buscarCEP()">
        <div id="cepErro" class="erro"></div>

        <!-- Endere√ßo -->
        <label for="rua">Rua:</label>
        <input type="text" id="rua" disabled>

        <div class="row">
          <div><label for="numero">N√∫mero:</label><input type="text" id="numero"></div>
          <div><label for="complemento">Complemento:</label><input type="text" id="complemento"></div>
        </div>

        <label for="bairro">Bairro:</label><input type="text" id="bairro" disabled>
        <label for="cidade">Cidade:</label><input type="text" id="cidade" disabled>
        <label for="estado">Estado:</label><input type="text" id="estado" disabled>

        <!-- Aceita visita -->
        <label for="visita">Aceita Visita?<span class="required">*</span></label>
        <select id="visita" required>
          <option value="">Selecione...</option>
          <option value="SIM">Sim</option>
          <option value="N√ÉO">N√£o</option>
        </select>

        <!-- Google Maps -->
        <label for="maps">URL do Google Maps:</label>
        <input type="url" id="maps" placeholder="Cole aqui a URL do Maps" oninput="previewMaps()">
        <div id="mapsPreview" class="preview"></div>

        <!-- Senha -->
        <label for="senha">Senha:<span class="required">*</span></label>
        <div class="senha-container">
          <input type="password" id="senha" required>
          <span class="toggle-senha" onclick="toggleSenha('senha', this)">üëÅÔ∏è</span>
        </div>

        <label for="confirmaSenha">Confirmar Senha:<span class="required">*</span></label>
        <div class="senha-container">
          <input type="password" id="confirmaSenha" required>
          <span class="toggle-senha" onclick="toggleSenha('confirmaSenha', this)">üëÅÔ∏è</span>
        </div>

        <p class="obrigatorio">‚ö†Ô∏è Os campos marcados com * s√£o de preenchimento obrigat√≥rio.</p>

        <button type="submit" class="btn-main">‚úÖ Finalizar Cadastro</button>
      </form>
    </section>
  </main>

  <script>
    // Pr√©-visualiza√ß√£o da foto
    document.getElementById("foto").addEventListener("change", function(){
      const file = this.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = function(e){
          const img = document.getElementById("fotoPreview");
          img.src = e.target.result;
          img.style.display = "block";
        }
        reader.readAsDataURL(file);
      }
    });

    // CEP autom√°tico
    async function buscarCEP(){
      const cep = document.getElementById("cep").value.replace(/\D/g,'');
      const erroDiv = document.getElementById("cepErro");
      if(cep.length !== 8) return;

      try{
        const resp = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const dados = await resp.json();

        if(dados.erro){
          erroDiv.style.display = "block";
          erroDiv.innerText = "‚ùå CEP n√£o encontrado. Preencha manualmente.";
          habilitarEndereco(true);
        } else {
          erroDiv.style.display = "none";
          document.getElementById("rua").value = dados.logradouro || "";
          document.getElementById("bairro").value = dados.bairro || "";
          document.getElementById("cidade").value = dados.localidade || "";
          document.getElementById("estado").value = dados.uf || "";
          habilitarEndereco(false);
        }
      }catch{
        erroDiv.style.display = "block";
        erroDiv.innerText = "‚ùå Erro ao buscar CEP. Preencha manualmente.";
        habilitarEndereco(true);
      }
    }

    function habilitarEndereco(habilitar){
      ["rua","bairro","cidade","estado"].forEach(id=>{
        document.getElementById(id).disabled = !habilitar;
      });
    }

    // WhatsApp preview
    document.getElementById("telefone").addEventListener("input", () => {
      const tel = document.getElementById("telefone").value.replace(/\D/g,'');
      const whatsDiv = document.getElementById("whatsLink");
      if(/^\d{10,11}$/.test(tel)){
        whatsDiv.innerHTML = `<a href="https://wa.me/55${tel}" target="_blank">
          <img src="whatsapp.png" alt="WhatsApp"> Conversar no WhatsApp
        </a>`;
      } else {
        whatsDiv.innerHTML = "";
      }
    });

    // Maps preview
    function previewMaps(){
      const url = document.getElementById("maps").value.trim();
      const div = document.getElementById("mapsPreview");
      div.innerHTML = url ? `<a href="${url}" target="_blank">
        <img src="GPS.png" alt="Maps"> Abrir localiza√ß√£o no Google Maps
      </a>` : "";
    }

    // Mostrar/ocultar senha
    function toggleSenha(id, el){
      const input = document.getElementById(id);
      if(input.type === "password"){
        input.type = "text";
        el.textContent = "üôà";
      } else {
        input.type = "password";
        el.textContent = "üëÅÔ∏è";
      }
    }

    // Valida√ß√£o de cadastro
    document.getElementById("formCadastro").addEventListener("submit", function(e){
      e.preventDefault();

      const email = document.getElementById("email").value.trim().toLowerCase();
      const erroDiv = document.getElementById("emailErro");
      const cadastros = JSON.parse(localStorage.getItem("cadastrosUsuarios")) || [];

      if(cadastros.some(u => (u.email||"").toLowerCase() === email)){
        erroDiv.style.display = "block";
        return;
      } else {
        erroDiv.style.display = "none";
      }

      const senha = document.getElementById("senha").value;
      const confirma = document.getElementById("confirmaSenha").value;
      if(senha !== confirma){
        alert("‚ùå As senhas n√£o coincidem!");
        return;
      }

      // Convertendo foto para base64
      let fotoBase64 = "";
      const fotoFile = document.getElementById("foto").files[0];
      if(fotoFile){
        const reader = new FileReader();
        reader.onload = function(e){
          fotoBase64 = e.target.result;
          salvarCadastro(fotoBase64);
        }
        reader.readAsDataURL(fotoFile);
      } else {
        salvarCadastro(fotoBase64);
      }
    });

    function salvarCadastro(fotoBase64){
      const cadastros = JSON.parse(localStorage.getItem("cadastrosUsuarios")) || [];
      const email = document.getElementById("email").value.trim().toLowerCase();

      const novoCadastro = {
        nome: document.getElementById("nome").value.trim(),
        apelido: document.getElementById("apelido").value.trim(),
        sexo: document.getElementById("sexo").value,
        telefone: document.getElementById("telefone").value.trim(),
        email: email,
        cep: document.getElementById("cep").value.trim(),
        rua: document.getElementById("rua").value.trim(),
        numero: document.getElementById("numero").value.trim(),
        complemento: document.getElementById("complemento").value.trim(),
        bairro: document.getElementById("bairro").value.trim(),
        cidade: document.getElementById("cidade").value.trim(),
        estado: document.getElementById("estado").value.trim(),
        visita: document.getElementById("visita").value,
        maps: document.getElementById("maps").value.trim(),
        senha: document.getElementById("senha").value,
        foto: fotoBase64
      };

      cadastros.push(novoCadastro);
      localStorage.setItem("cadastrosUsuarios", JSON.stringify(cadastros));

      alert("‚úÖ Cadastro realizado com sucesso!");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
