<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro - Pedidos de Ora√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#fff7f2;
      --card:#ffffff;
      --text:#2c3e50;
      --muted:#6b7b8c;
      --primary:#b22222;        /* vermelho queimado */
      --primary-hov:#800000;    /* vinho escuro */
      --accent:#ff4500;         /* laranja vivo */
      --accent-hov:#e03c00;     /* laranja escuro */
      --ring:rgba(178,34,34,.35);
    }

    body{
      margin:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* Cabe√ßalho */
    header{
      background:var(--primary);
      color:#ffd700; /* dourado */
      padding:20px;
      text-align:center;
      box-shadow:0 2px 10px rgba(0,0,0,.15);
      text-shadow:0 0 6px rgba(255,215,0,0.6);
    }
    header h1{
      margin:0;
      font-size:24px;
      letter-spacing:.5px;
    }

    /* Container */
    .container{
      max-width:720px;
      margin:32px auto;
      padding:0 16px;
    }

    /* Card */
    .card{
      background:var(--card);
      border-radius:14px;
      padding:24px;
      box-shadow:0 12px 30px rgba(0,0,0,.08);
      border:1px solid rgba(0,0,0,.04);
    }

    label{
      display:block;
      font-weight:600;
      margin:14px 0 6px;
    }

    input,button{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      font-size:15px;
    }

    input{
      border:1px solid #e1e5ea;
      outline:none;
    }
    input:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 4px var(--ring);
    }

    /* Bot√µes */
    button{
      border:none;
      font-weight:700;
      cursor:pointer;
      margin-top:12px;
      transition:.3s;
    }
    .btn-main{
      background:var(--primary);
      color:#fff;
    }
    .btn-main:hover{
      background:var(--primary-hov);
    }
    .btn-home{
      background:#fff;
      color:var(--accent);
      border:1px solid #e1e5ea;
    }
    .btn-home:hover{
      background:#f7f9fb;
      color:var(--accent-hov);
    }

    /* Layout responsivo */
    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .row>div{
      flex:1;
      min-width:140px;
    }

    /* Radios */
    .radios{
      display:flex;
      gap:20px;
      flex-wrap:wrap;
      margin:8px 0;
    }
    .radio-option{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .radio-option input{
      accent-color:var(--primary);
    }

    /* Preview links */
    .preview{
      margin-top:8px;
      font-size:14px;
    }
    .preview a{
      color:var(--primary);
      text-decoration:none;
    }

    .login-info{
      margin-top:20px;
      padding:12px;
      background:#f9f9f9;
      border-radius:10px;
      font-size:14px;
      border:1px solid #e1e5ea;
    }

    /* Responsividade */
    @media (max-width: 768px){
      header h1{font-size:20px}
      .container{margin:16px auto}
      .card{padding:18px}
      button{font-size:14px;padding:10px}
    }
  </style>
</head>
<body>
  <header><h1>üìù Cadastro</h1></header>
  <main class="container">
    <section class="card">
      <p>Ao se cadastrar poderemos te conhecer um pouco mais e voc√™ ter√° acesso a mais funcionalidades do nosso site!</p>
      <form id="formCadastro">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" required>

        <label>Sexo:</label>
        <div class="radios">
          <label class="radio-option"><input type="radio" name="sexo" value="MASCULINO" required> MASCULINO</label>
          <label class="radio-option"><input type="radio" name="sexo" value="FEMININO" required> FEMININO</label>
        </div>

        <label for="telefone">Telefone (DDD + n√∫mero):</label>
        <input type="tel" id="telefone" placeholder="11912345678" pattern="\d{10,11}" required>
        <div id="whatsLink" class="preview"></div>

        <label for="email">E-mail:</label>
        <input type="email" id="email" placeholder="seuemail@exemplo.com" required>

        <label for="cep">CEP:</label>
        <input type="text" id="cep" maxlength="8" onblur="buscarCEP()" required>

        <div id="enderecoAuto" style="display:none;">
          <label for="rua">Rua:</label><input type="text" id="rua">
          <label for="bairro">Bairro:</label><input type="text" id="bairro">
        </div>

        <div class="row">
          <div><label for="numero">N√∫mero:</label><input type="text" id="numero" required></div>
          <div><label for="complemento">Complemento:</label><input type="text" id="complemento"></div>
        </div>

        <label for="referencia">Ponto de Refer√™ncia:</label>
        <input type="text" id="referencia">

        <label>Aceita Visita?</label>
        <div class="radios">
          <label class="radio-option"><input type="radio" name="visita" value="SIM" required>SIM</label>
          <label class="radio-option"><input type="radio" name="visita" value="N√ÉO" required>N√ÉO</label>
        </div>

        <label for="maps">URL do Google Maps:</label>
        <input type="url" id="maps" oninput="previewMaps()" required>
        <div id="mapsPreview" class="preview"></div>

        <label for="senha">Senha:</label>
        <input type="password" id="senha" required>

        <label for="confirmaSenha">Confirmar Senha:</label>
        <input type="password" id="confirmaSenha" required>

        <div id="loginInfo" class="login-info"></div>

        <button type="submit" class="btn-main">‚úÖ Finalizar Cadastro</button>
        <button type="button" class="btn-home" onclick="location.href='index.html'">üè† P√°gina Inicial</button>
      </form>
    </section>
  </main>

  <script>
    // Garante admin fixo
    function garantirAdmin(){
      let cadastros = JSON.parse(localStorage.getItem("cadastrosUsuarios")) || [];
      const existeAdmin = cadastros.some(u => u.email === "admin");
      if(!existeAdmin){
        cadastros.push({
          nome: "Administrador",
          sexo: "MASCULINO",
          telefone: "",
          email: "admin",
          cep: "",
          rua: "",
          bairro: "",
          numero: "",
          complemento: "",
          referencia: "",
          visita: "N√ÉO",
          maps: "",
          senha: "pedidodeoracao",
          fixo: true
        });
        localStorage.setItem("cadastrosUsuarios", JSON.stringify(cadastros));
      }
    }
    garantirAdmin();

    // Busca CEP no ViaCEP
    async function buscarCEP(){
      const cep = document.getElementById("cep").value.replace(/\D/g, '');
      if(cep.length !== 8) return;
      try{
        const resp = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const dados = await resp.json();
        document.getElementById("enderecoAuto").style.display = "block";
        document.getElementById("rua").value = dados.logradouro || "";
        document.getElementById("bairro").value = dados.bairro || "";
      }catch(e){
        document.getElementById("enderecoAuto").style.display = "block";
      }
    }

    // WhatsApp link preview
    document.getElementById("telefone").addEventListener("input", () => {
      const tel = document.getElementById("telefone").value.replace(/\D/g,'');
      const whatsDiv = document.getElementById("whatsLink");
      if(/^\d{10,11}$/.test(tel)){
        whatsDiv.innerHTML = `üì± <a href="https://wa.me/55${tel}" target="_blank">Abrir WhatsApp para +55 ${tel}</a>`;
      } else {
        whatsDiv.innerHTML = "";
      }
    });

    // Maps preview
    function previewMaps(){
      const url = document.getElementById("maps").value.trim();
      const div = document.getElementById("mapsPreview");
      div.innerHTML = url ? `üåç <a href="${url}" target="_blank">Visualizar localiza√ß√£o</a>` : "";
    }

    // Cadastro
    document.getElementById("formCadastro").addEventListener("submit", function(e){
      e.preventDefault();

      const senha = document.getElementById("senha").value;
      const confirma = document.getElementById("confirmaSenha").value;
      if(senha !== confirma){ alert("‚ùå As senhas n√£o coincidem!"); return; }

      let cadastros = JSON.parse(localStorage.getItem("cadastrosUsuarios")) || [];

      const novoCadastro = {
        nome: document.getElementById("nome").value.trim(),
        sexo: document.querySelector("input[name='sexo']:checked")?.value,
        telefone: document.getElementById("telefone").value.trim(),
        email: document.getElementById("email").value.trim(),
        cep: document.getElementById("cep").value.trim(),
        rua: document.getElementById("rua").value.trim(),
        bairro: document.getElementById("bairro").value.trim(),
        numero: document.getElementById("numero").value.trim(),
        complemento: document.getElementById("complemento").value.trim(),
        referencia: document.getElementById("referencia").value.trim(),
        visita: document.querySelector("input[name='visita']:checked")?.value,
        maps: document.getElementById("maps").value.trim(),
        senha: senha
      };

      // üö® Verifica e-mail duplicado
      const existe = cadastros.some(u => u.email.toLowerCase() === novoCadastro.email.toLowerCase());
      if(existe){
        alert("‚ùå J√° existe um cadastro com este e-mail. Por favor, utilize outro.");
        return;
      }

      cadastros.push(novoCadastro);

      localStorage.setItem("cadastrosUsuarios", JSON.stringify(cadastros));

      document.getElementById("loginInfo").innerHTML = `
        <strong>Seus dados de acesso:</strong><br>
        üìß Login (e-mail): ${novoCadastro.email}<br>
        üîë Senha: ${novoCadastro.senha}
      `;

      alert("‚úÖ Cadastro realizado com sucesso!");
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
